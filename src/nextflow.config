/*
========================================================================================
    Nextflow Configuration for Metagenomics Pipeline
========================================================================================
*/

// --- Profile Definitions ---
profiles {
    // Default profile for local execution on your 32-core machine
    standard {
        process.executor = 'local'
        executor.cpus = 30
        executor.queueSize = 20
        executor.memory = '140 GB' // Reserve some memory for the OS
    }
}

// --- Global Parameters ---
params {
    outdir = "/net/afscra/people/plgpkica/metagenome_proj/results"
}

// --- Process-Specific Configurations ---
process {
    // Default resources for any process not specified below
    cpus = 16
    memory = '60 GB'

    // Override resources for specific, demanding processes
    //withName: 'MEGAHIT_ASSEMBLY' {
    //    cpus = 24 // Assembly is very resource-intensive
    //    memory = '50 GB'
    //}
}

// --- Environment Module Configuration ---
conda {
    enabled = true
    conda.channels = ['conda-forge', 'bioconda', 'defaults']
    cacheDir = "/net/afscra/people/plgpkica/metagenome_proj/conda"
}

env {
    GTDBTK_DATA_PATH = "/net/afscra/people/plgpkica/metagenome_proj/databases/gtdbtk_db/release226"
}

resume = true

def trace_timestamp = new java.util.Date().format( 'yyyy-MM-dd_HH-mm-ss')
timeline {
    enabled = true
    file    = "${params.outdir}/pipeline_info/${trace_timestamp}/execution_timeline.html"
}
report {
    enabled = true
    file    = "${params.outdir}/pipeline_info/${trace_timestamp}/execution_report.html"
}
trace {
    enabled = true
    file    = "${params.outdir}/pipeline_info/${trace_timestamp}/execution_trace.txt"
}
dag {
    enabled = true
    file    = "${params.outdir}/pipeline_info/${trace_timestamp}/pipeline_dag.html"
}
